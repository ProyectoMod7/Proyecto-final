{% extends "base.html" %}

{% block title %}
    {% if pieza %}Editar Pieza{% else %}Crear Pieza{% endif %}
{% endblock %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-4">
        {% if pieza %}
            ✏️ Editar Pieza
        {% else %}
            ➕ Crear Pieza
        {% endif %}
    </h2>

    <form method="POST">

        <!-- NOMBRE -->
        <div class="mb-3">
            <label class="form-label">Nombre de la pieza</label>
            <input type="text" name="nombre" class="form-control" required
                   value="{{ pieza.nombre if pieza else '' }}">
        </div>

        <!-- FABRICANTE -->
        <div class="mb-3">
            <label class="form-label">Fabricante</label>
            <select name="fabricante_id" class="form-control">
                <option value="">-- Seleccionar fabricante --</option>
                {% for fab in fabricantes %}
                    <option value="{{ fab.id }}"
                        {% if pieza and pieza.fabricante_id == fab.id %}selected{% endif %}>
                        {{ fab.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- MATERIAL -->
        <div class="mb-3">
            <label class="form-label">Material</label>
            <select name="material_id" class="form-control">
                <option value="">-- Seleccionar material --</option>
                {% for mat in materiales %}
                    <option value="{{ mat.id }}"
                        {% if pieza and pieza.material_id == mat.id %}selected{% endif %}>
                        {{ mat.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- VIDA EN DÍAS -->
        <div class="mb-3">
            <label class="form-label">Vida útil (días)</label>
            <input type="number" name="vida_dias" class="form-control" min="1"
                   value="{{ pieza.vida_dias if pieza and pieza.vida_dias else '' }}">
        </div>

        <!-- FECHA DE INSTALACIÓN -->
        <div class="mb-3">
            <label class="form-label">Fecha de instalación</label>
            <input type="date" name="fecha_instalacion" class="form-control"
                   value="{{ pieza.fecha_instalacion if pieza and pieza.fecha_instalacion else '' }}">
            <small class="text-muted">
                Si se deja vacío, se tomará la fecha de hoy automáticamente.
            </small>
        </div>

        <!-- IMAGEN URL -->
        <div class="mb-3">
            <label class="form-label">URL de imagen (opcional)</label>
            <input type="text" name="imagen_url" class="form-control"
                   value="{{ pieza.imagen_url if pieza else '' }}">
        </div>

        <!-- BOTONES -->
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                {% if pieza %}Guardar Cambios{% else %}Crear Pieza{% endif %}
            </button>

            <a href="{{ url_for('piezas.index') }}" class="btn btn-secondary ms-2">
                Cancelar
            </a>
        </div>

    </form>

</div>

{% endblock %}
