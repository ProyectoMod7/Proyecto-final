{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Listado de Máquinas</h3>
        <a href="{{ url_for('maquinas.crear') }}" class="btn btn-primary">+ Nueva Máquina</a>
    </div>

    <table class="table table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th>Nombre</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Estado</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>

        <tbody>
            {% for m in maquinas %}
            <tr>
                <td>{{ m.nombre }}</td>
                <td>{{ m.marca or "—" }}</td>
                <td>{{ m.modelo or "—" }}</td>

                <!-- Estado visual -->
                <td>
                    {% set est = m.estado_color %}

                    {% if est == 'green' %}
                        <span class="badge bg-success p-2">Óptima</span>

                    {% elif est == 'yellow' %}
                        <span class="badge bg-warning text-dark p-2">Advertencia</span>

                    {% elif est == 'red' %}
                        <span class="badge bg-danger p-2">Crítica</span>

                    {% elif est == 'black' %}
                        <span class="badge bg-dark p-2">Rota</span>

                    {% else %}
                        <span class="badge bg-secondary p-2">Sin datos</span>
                    {% endif %}
                </td>

                <td class="text-center">
                    <a class="btn btn-sm btn-info"
                       href="{{ url_for('piezas_instaladas.listar_por_maquina', maquina_id=m.id) }}">
                       Ver piezas
                    </a>

                    <a class="btn btn-sm btn-warning"
                       href="{{ url_for('maquinas.editar', id=m.id) }}">
                       Editar
                    </a>

                    <form action="{{ url_for('maquinas.eliminar', id=m.id) }}"
                          method="POST" style="display:inline-block;"
                          onsubmit="return confirm('¿Eliminar máquina?');">
                        <button class="btn btn-sm btn-danger">Eliminar</button>
                    </form>
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

{% endblock %}
